"use strict";var dataAccess=require("../data_access"),logger=require("./../logger").logger,cipher=require("../cipher"),e=require("../errors"),log=logger.getLogger("ServicesResource"),doInit=function(e){var r=global.config.nuve.superserviceID;return e._id=e._id+"",e._id===r};exports.create=function(r,i,t){var n=r.authData||{};if(!doInit(n.service))return log.info("Service ",n.service._id," not authorized for this action"),t(new e.AccessError("Permission denied"));var s=r.body;if("string"!=typeof s.name||"string"!=typeof s.key)return t(new e.BadRequestError("Service name and key do not have string type"));s.encrypted=!0,s.key=cipher.encrypt(cipher.k,s.key),dataAccess.service.create(s,function(e,r){if(e)return log.warn("Failed to create service:",e.message),t(e);log.info("Service created: ",s.name),i.send(r)})},exports.represent=function(r,i,t){var n=r.authData||{};if(!doInit(n.service))return log.info("Service ",n.service," not authorized for this action"),t(new e.AccessError("Permission denied"));dataAccess.service.list(function(e,r){if(e)return log.warn("Failed to list services:",e.message),t(e);log.info("Representing services"),i.send(r)})};